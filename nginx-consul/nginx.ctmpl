events { }

http {
    upstream ping-nodejs-backend {
        {{range service "ping-nodejs"}}
        server {{.Address}}:{{.Port}};
        {{else}}
        server 127.0.0.1:65535; # no service instances have registered yet, return 502 error
        {{end}}
    }

    server {
        listen 80;

        location / {
            proxy_pass http://ping-nodejs-backend;
        }
    }
}
